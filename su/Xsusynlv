#! /bin/sh
# Authors: Jack Cohen, John Stockwell--03/94
WIDTH=600
HEIGHT=450
WIDTHOFF1=0
WIDTHOFF2=640
HEIGHTOFF1=50
HEIGHTOFF2=530

#Remark: Since synlv puts 10^3 in header fields internally,
#        use kilo_units in distances and velocities

######Common parameters for demo######
v00=5.0     # P-wave velocity at surface
dvdx=1.0    # velocity gradient (dv/dx)
dvdz=2.0    # velocity gradient (dv/dz)
nt=351 dt=0.004
fpeak=25.0  # should be <= half nyquist to avoid spatial aliasing


######Common Shot gathers (specify nxs, fxs, dxs)######
# Hint: Keep shots well away from the boundaries to avoid edge contributions.
#       Here, model goes from 0 to 12, first shot at fxs=4.0, last receiver
#       roughly at fxs + nxs*dxs + nxo*dxo = 5.6

#  ref="1:1,2;4,2"      reflector(s):  "amplitude:x1,z1;x2,z2;x3,z3;..."
REF1="1.0:0.0,1.0;12.0,1.0"
REF2="0.7:0.0,1.6;12.0,3.6"
REF3="0.5:0.0,4.2;2.0,3.5;5.0,4.2;7.0,4.7;12.0,4.2"
nxo=16 fxo=0.1 dxo=0.1  # offset information: number, first, spacing
nxs=6  fxs=4.0 dxs=0.1  # shot information: number, first, spacing
ob=0			# to eliminate the turned ray contribution

susynlv v00=$v00 dvdx=$dvdx dvdz=$dvdz \
		nt=$nt dt=$dt verbose=0 \
		ref=$REF1 ref=$REF2 ref=$REF3 \
		nxo=$nxo fxo=$fxo dxo=$dxo \
		nxs=$nxs fxs=$fxs dxs=$dxs \
		ob=$ob fpeak=$fpeak ndpfz=10 |
suxmovie perc=99 title="Shot Gathers" windowtitle="Shots" \
	label1="Time (sec)" label2="Shot Gather" f2=1 d2=0.0625 \
	-geometry ${WIDTH}x${HEIGHT}+${WIDTHOFF1}+${HEIGHTOFF1} &
# Note: 16 offsets at nominal unit spacing (tracr), so d2 = 1/16 = 0.0625


# Include turned ray contributions: ob=1 (these are weak!)
#  ref="1:1,2;4,2"      reflector(s):  "amplitude:x1,z1;x2,z2;x3,z3;..."
REF1="0.5:0.0,1.0;12.0,1.0"
REF2="1.0:0.0,1.6;12.0,3.6"
REF3="0.5:0.0,4.2;2.0,3.5;5.0,4.2;7.0,4.7;12.0,4.2"
nxo=64 fxo=0.1 dxo=0.1  # offset information: number, first, spacing
nxs=2  fxs=4.0 dxs=0.1  # shot information: number, first, spacing
ob=1  	 		# include turned ray contribution

susynlv v00=$v00 dvdx=$dvdx dvdz=$dvdz \
		nt=$nt dt=$dt verbose=0 \
		ref=$REF1 ref=$REF2 ref=$REF3 \
		nxo=$nxo fxo=$fxo dxo=$dxo \
		nxs=$nxs fxs=$fxs dxs=$dxs \
		ob=$ob fpeak=$fpeak ndpfz=10 |
suxmovie perc=99 title="Shot Gathers with Turned Rays" \
	windowtitle="with Turned Rays" \
	label1="Time (sec)" label2="Shot Gather" \
	f2=1 d2=0.015625 f2num=1 d2num=1 \
	-geometry ${WIDTH}x${HEIGHT}+${WIDTHOFF2}+${HEIGHTOFF1} &
# Note: nxo=64, so d2 = 1/nxo = 0.015625

#########################################################

######Common Midpoint gathers (specify n#include "/usr/local/cwp/include/su.h"
#include "/usr/local/cwp/include/segy.h"
#include "/usr/local/cwp/src/Complex/include/Complex.h"
#include "/home/dtrad/radon/clibrary/clibrary.h"
#include "Dcomplex.h"
#include <math.h>
dcomplex sin(dcomplex);
#define LOOKFAC	2	/* Look ahead factor for npfaro	  */
#define PFA_MAX	720720	/* Largest allowed nfft	          */
void p_stack(float *pos, float **d, float dt,float **m, float *q, float dq,
	     float eps1, float eps2, float eps, float fmax)
{
   int it, ih, iq$nxm fxm=$fxm dxm=$dxm \
		ob=$ob fpeak=$fpeak ndpfz=10 |
suxmovie perc=99 title="Midpoint Gathers" windowtitle="Midpoints" \
	label1="Time (sec)" label2="Midpoint Gather" f2=1 d2=0.0625 \
	-geometry ${WIDTH}x${HEIGHT}+${WIDTHOFF1}+${HEIGHTOFF2} &
# Note: 16 offsets at nominal unit spacing (tracr), so d2 = 1/16 = 0.0625


#########################################################

######Common Offset Section generated by subsetting common shot gathers#####
#  ref="1:1,2;4,2"      reflector(s):  "amplitude:x1,z1;x2,z2;x3,z3;..."
REF1="1.0:0.0,1.0;12.0,1.0"
REF2="0.8:0.0,1.01;12.0,6.0"
nxo=2  fxo=0.1 dxo=0.1   # offset information: number, first, spacing
nxs=32 fxs=4.0 dxs=0.05  # shot information: number, first, spacing
ob=0  	 		 # to eliminate the turned ray contribution
offset=200

susynlv v00=$v00 dvdx=$dvdx dvdz=$dvdz \
		nt=$nt dt=$dt verbose=0 \
		ref=$REF1 ref=$REF2 \
		nxo=$nxo fxo=$fxo dxo=$dxo \
		nxs=$nxs fxs=$fxs dxs=$dxs \
		ob=$ob fpeak=$fpeak ndpfz=10 |
suwind key=offset min=$offset max=$offset |
suxmovie perc=99 title="Common Offset $offset" windowtitle="Offset $offset" \
	label1="Time (sec)" label2="Channel" f2=1 d2=1 \
	-geometry ${WIDTH}x${HEIGHT}+${WIDTHOFF2}+${HEIGHTOFF2} &

exit 0
